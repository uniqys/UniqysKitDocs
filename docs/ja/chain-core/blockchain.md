---
title: ブロックチェーン
---

# ブロックチェーン

## データ構造

Chain Coreの生成するブロックチェーンの各ブロックのヘッダには以下のデータを保持しています。

- **height**: ブロックの高さ
- **timestamp**: ブロックが生成された時間のタイムスタンプ
- **lastBlockHash**: 前ブロックのハッシュ値
- **transactionRoot**: トランザクションのマークルルート
- **lastBlockConsensusRoot**: 前ブロックのコンセンサスのマークルルート
- **nextValidatorSetRoot**: 次ブロックのバリデータセットのマークルルート
- **appStateHash**: アプリケーションの状態

## 前後ブロックの関連

Chain Coreのブロックチェーンでは、前後のブロック間に関連性があります。
この関連性により、あるトランザクションは含められたブロックの2つ先のブロックで、その実行結果が保証されます。

高さNのブロックをブロック(N)と表記します。

### トランザクションの関連

#### ブロック(N)

このブロックに含められたトランザクションは、ブロックの承認後にアプリケーションへリクエストとして送信されます。

#### ブロック(N+1)

ブロック(N)で承認されたトランザクションがアプリケーション上で実行され、このブロックの`appState`（アプリケーションの状態）として取り込まれます。

### コンセンサスの関連

#### ブロック(N)

ブロックデータの`nextValidatorSet`により、ブロック(N)はブロック(N+1)のバリデータセットを保持します。

#### ブロック(N+1)

ブロック(N+1)は、一つ前のブロック(N)のコンセンサス（署名一覧）である`lastBlockConsensus`を含めます。
コンセンサスはブロックのハッシュに対して得るものなので、そのブロックには含めることができず、次のブロックに含められます。

また、ブロック(N+1)のコンセンサスを得る際は、ブロック(N)の`nextValidatorSet`のノードからの署名が集められます。

#### ブロック(N+2)

ブロック(N+2)の`lastBlockConsensus`でブロック(N+1)のコンセンサスがブロックに取り込まれます。
それにより、ブロック(N+1)の`appState`が保証されたといえます。

:::tip ポイント
あるブロックは次のブロックの`lastBlockConsensus`でコンセンサスが含められることによってファイナリティを得られるといえます。
つまり、ブロック(N)で含められたトランザクションは、その実行結果がブロック(N+1)でブロックに含められ、ブロック(N+2)で実行結果が保証されるということになります。
:::
